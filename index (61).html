<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YouTube Search Widget</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      padding: 20px;
    }
    .search-row {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    input[type="search"] {
      flex: 1;
      padding: 8px 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      padding: 8px 12px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      border: 1px solid #888;
      background: #fff;
    }
    a, button, input {
      outline: none;
      -webkit-tap-highlight-color: transparent;
    }
    a:focus-visible, button:focus-visible, input:focus-visible {
      outline: none;
    }
    #results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      gap: 12px;
    }
    iframe{
      border-radius:8px;
      border:3px solid #aaa;
      min-width:95%; height:auto;
      min-height:300px;
    }
  </style>
</head>
<body>
  <input id="handle" type="search" placeholder="@technicalguruji" />
  <button onclick="getChannelId()">Search this channel only</button>
  <div id="output"></div><br><br>

  <div class="search-row">
    <input id="q" type="search" placeholder="Search YouTube (e.g. javascript tutorial)" />
    <button id="searchBtn" onclick="runSearch()">Search</button>
  </div>

  Sort by:
  <select id="order" onchange="ordr2=this.value;runSearch()">
    <option value="relevance">Relevance</option>
    <option value="date">Upload Date</option>
    <option value="viewCount">View Count</option>
    <option value="rating">Rating</option>
  </select>

  <br><br>

  <!-- Embedded player -->
  <div id="player" style="display:flex; align-items:center;place-content:center; margin-bottom:20px;width:100%;height:fit-content"></div>

  <!-- Search results -->
  <div id="results"></div>

  <script>
    // ====== CONFIG ======
   var API_KEY = "AIzaSyDjFdxgrypLQ0NF6K1oerqfeoFMG8W5F8c";
  // API_KEY="AIzaSyBoN9Ckz9Bsb40UfrRG3hyVGORby_Tj-hg";
API_KEY="AIzaSyBoyY45QjnFhm5jo-lW3CiHd7ybh0AGMDY";
    let channelId2 = "";
    let ordr2 = "";

    async function getChannelId() {
      const handleInput = document.getElementById("handle");
      const output = document.getElementById("output");
      let handle = handleInput.value.trim();

      if (!handle) {
        output.textContent = "Enter a channel handle like @GoogleDevelopers";
        return;
      }
      if (!handle.startsWith("@")) handle = "@" + handle;

      output.textContent = "Fetching...";

      try {
        const url2 = `https://www.googleapis.com/youtube/v3/channels?part=snippet&forHandle=${encodeURIComponent(handle)}&key=${API_KEY}`;
        const res2 = await fetch(url2);
        const data2 = await res2.json();

        if (!data2.items || data2.items.length === 0) {
          output.textContent = "❌ No channel found for: " + handle;
          return;
        }

        const ch2 = data2.items[0];
        channelId2 = ch2.id;
        const title2 = ch2.snippet.title;
        const desc2 = ch2.snippet.description || "No description available.";
        output.innerHTML = `✅ Channel Name: <b>${title2}</b><br>Description: ${desc2}`;
      } catch (err) {
        output.textContent = "Error: " + err.message;
      }
    }

    async function runSearch() {
      const query = document.getElementById("q").value.trim();
      const results = document.getElementById("results");
      if (!query) {
        results.textContent = "Enter a search query!";
        return;
      }

      results.textContent = "Searching...";

      try {
        let url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=25&q=${encodeURIComponent(query)}&regionCode=IN&key=${API_KEY}`;
        if (ordr2) url += `&order=${ordr2}`;
        if (channelId2) url += `&channelId=${channelId2}`;

        const res = await fetch(url);
        const data = await res.json();

        if (!data.items || data.items.length === 0) {
          results.textContent = "❌ No results found.";
          return;
        }

        // fetch video details (statistics + duration)
        const videoIds = data.items.map(v => v.id.videoId).join(",");
        const detailsUrl = `https://www.googleapis.com/youtube/v3/videos?part=statistics,contentDetails&id=${videoIds}&key=${API_KEY}`;
        const detailsRes = await fetch(detailsUrl);
        const detailsData = await detailsRes.json();

        const detailsMap = {};
        detailsData.items.forEach(item => {
          const { statistics, contentDetails } = item;
          detailsMap[item.id] = {
            stats: statistics,
            duration: formatDuration(contentDetails.duration)
          };
        });

        results.innerHTML = data.items.map(item => {
          const { title, channelTitle, thumbnails, publishedAt } = item.snippet;
          const videoId = item.id.videoId;
          const timeAgo = getTimeAgo(publishedAt);
          const details = detailsMap[videoId] || {};
          const views = details.stats?.viewCount ? formatViews(details.stats.viewCount) : "";
          const duration = details.duration || "";

          return `
            <div onclick="playVideo('${videoId}')" 
                 style="display: flex; align-items: flex-start; border: 1px solid #ddd; border-radius: 10px; padding: 10px; cursor:pointer; background:white;"
                 onmouseover="this.style.background='#f8f8f8'" 
                 onmouseout="this.style.background='white'">
              <img src="${thumbnails.medium.url}" width="160" height="90" style="border-radius: 8px; margin-right: 12px;">
              <div style="flex: 1;">
                <div style="font-weight: 600; color: #000;">${title}</div>
                <div style="color: #777; font-size: 14px; margin-top: 5px;">${channelTitle}</div>
                <div style=" color: #777; font-size: 14px; margin-top: 5px;" >${views} views</div>
                <div style="display: flex; justify-content: space-between; color: #777; font-size: 14px; margin-top: 5px;">
                  <span>&nbsp;</span>
                    <span>${timeAgo}</span>
                </div>
               <div style="color: #777; font-size: 14px; margin-top: 5px;" >${duration}</div>
            </div>
            </div>`;
        }).join("");

      } catch (err) {
        results.textContent = "Error: " + err.message;
      }
    }

    function playVideo(videoId) {
      const player = document.getElementById("player");
      player.innerHTML = `
        <iframe 
          src="https://www.youtube.com/embed/${videoId}?autoplay=1"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen>
        </iframe>`;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function getTimeAgo(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
      if (diffDays < 1) return "Today";
      if (diffDays === 1) return "1 day ago";
      if (diffDays < 7) return `${diffDays} days ago`;
      const diffWeeks = Math.floor(diffDays / 7);
      if (diffWeeks < 4) return `${diffWeeks} week${diffWeeks > 1 ? "s" : ""} ago`;
      const diffMonths = Math.floor(diffDays / 30);
      if (diffMonths < 12) return `${diffMonths} month${diffMonths > 1 ? "s" : ""} ago`;
      const diffYears = Math.floor(diffDays / 365);
      return `${diffYears} year${diffYears > 1 ? "s" : ""} ago`;
    }

    function formatViews(views) {
      const n = Number(views);
      if (n < 1000) return n;
      if (n < 100000) return (n / 1000).toFixed(1) + "k";
      if (n < 1000000) return (n / 100000).toFixed(1) + "L";
      if (n < 10000000) return (n / 1000000).toFixed(1) + "M";
      return (n / 10000000).toFixed(1) + "Cr";
    }

    function formatDuration(duration) {
      const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
      if (!match) return "";
      const h = match[1] ? match[1] + ":" : "";
      const m = match[2] ? match[2].padStart(2, "0") : "00";
      const s = match[3] ? match[3].padStart(2, "0") : "00";
      return h ? `${h}${m}:${s}` : `${m}:${s}`;
    }
  </script>
</body>
</html>
